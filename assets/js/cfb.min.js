window.c7FormBuilder=function(a){"use strict";a.fn.findAll=function(b){return a(this).find(b).addBack(b)};var b={tabs:{initialize:function(c){b.hasTabs(c)&&(c.find(".cfb-form-fields-wrapper").addClass("cfb-tab-content"),this.activateTab(c),c.on("click",".cfb-form-tabs",function(d){d.preventDefault(),b.tabs.activateTab(c,a(d.currentTarget).data("tab"))}))},getDefaultTab:function(a){var b=a.find(".cfb-form-tabs-wrapper").data("default-tab");return 0===a.find('.cfb-form-tabs[data-tab="'+b+'"]').length&&(b=a.find(".cfb-form-tabs").first().data("tab")),wp.hooks.applyFilters("cfb.get_default_tab",b,a)},activateTab:function(b,c){c=c||this.getDefaultTab(b),b.find('.cfb-form-tabs[data-tab="'+c+'"]').addClass("cfb-active-tab").siblings().removeClass("cfb-active-tab"),b.find(".cfb-form-fields > .cfb-field-wrapper").each(function(){a(this).data("tab")===c?a(this).fadeIn():a(this).hide()}),wp.hooks.doAction("cfb.activated_tab",b,c)}},fields:{color:{initialize:function(a){a.find('input[type="text"]').wpColorPicker()}},editor:{initialize:function(c){b.getAllFieldControls(c,{type:"editor"}).each(function(){var b=a(this).find(".wp-editor-wrap"),c=b.find(".wp-editor-area").attr("id"),d=b.attr("data-editor-settings");if("undefined"==typeof tinyMCEPreInit.mceInit[c]&&(tinyMCEPreInit.mceInit[c]=a.extend({},tinyMCEPreInit.mceInit[d],{selector:"#"+c,body_class:c})),"undefined"==typeof tinyMCEPreInit.qtInit[c]&&(tinyMCEPreInit.qtInit[c]=a.extend({},tinyMCEPreInit.qtInit[d],{id:c})),!tinymce.get(c)&&b.hasClass("tmce-active"))try{tinymce.init(tinyMCEPreInit.mceInit[c])}catch(e){}if("undefined"!=typeof quicktags&&!QTags.getInstance(c))try{quicktags(tinyMCEPreInit.qtInit[c]),QTags._buttonsInit()}catch(e){}})},destroy:function(c){b.getAllFieldControls(c,{type:"editor"}).each(function(){var b=a(this).find(".wp-editor-area"),c=b.attr("id"),d=tinymce.get(c);d&&(d.save(),d.remove()),a(this).find("#qt_"+c+"_toolbar").remove(),delete QTags.instances[c]})}}},sortable:{initialize:function(c){b.isRepeatableField(c)&&b.getFieldControlWrapper(c).sortable({cursor:"move",handle:".cfb-sort-handle",items:" > .cfb-field-control",forcePlaceholderSize:!0,forceHelperSize:!0,tolerance:"pointer",placeholder:"cfb-field-control cfb-field-control-placeholder",start:function(b,c){var d=a(b.target).find("> .cfb-field-control").not(".cfb-empty-control").index(c.item);c.item.data("sortstart-index",d),wp.hooks.doAction("cfb.sortstart",b,c)},stop:function(a,b){wp.hooks.doAction("cfb.sortstop",a,b)},update:function(a,b){wp.hooks.doAction("cfb.sortupdate",a,b)}})}},l18n:function(a,b){return cfbL10n[a]||b||""},getFormName:function(a){return a.data("name")},getFieldName:function(a){return a.data("name")},getFormType:function(a){return a.data("type")},getFieldType:function(a){return a.data("type")},hasTabs:function(a){return a.find(".cfb-form-tabs-wrapper").length>0},isRepeatableField:function(a){return a.hasClass("cfb-repeatable")},getFieldControlWrapper:function(a){return a.find(".cfb-field-control-wrapper").first()},getFieldControls:function(a,b){b=b||!1;var c=this.getFieldControlWrapper(a).find("> .cfb-field-control");return b?c:c.not(".cfb-empty-control")},getAllFieldControls:function(c,d){d=a.extend({},{type:"",includeEmpty:!1},d);var e=d.type?".cfb-"+d.type+"-field .cfb-field-control":".cfb-field-control",f=c.findAll(e);return d.includeEmpty?f:f.not(function(){return b.isEmptyControl(a(this))})},isEmptyControl:function(a){return a.hasClass("cfb-empty-control")?!0:a.parentsUntil(".cfb-form-fields",".cfb-empty-control").length>0?!0:!1},canAddControl:function(a){var b=a.data("repeatable-max"),c=this.getFieldControls(a).length;return b?b>c:!0},canRemoveControl:function(a){var b=a.data("repeatable-min")||1,c=this.getFieldControls(a).length;return c>b},addControl:function(a,b,c){if(b=b||a.closest(".cfb-field-wrapper"),c=c||b.closest(".cfb-form-wrapper"),this.canAddControl(b)){var d=a.siblings(".cfb-empty-control").clone().removeClass("cfb-empty-control");wp.hooks.doAction("cfb.pre_add_control",d,b,c),a.after(d),this.updateControls(d.nextAll(".cfb-field-control").addBack(),b,c),this.toggleHandles(b),wp.hooks.doAction("cfb.added_control",d,b,c)}},removeControl:function(a,b,c){if(b=b||a.closest(".cfb-field-wrapper"),c=c||b.closest(".cfb-form-wrapper"),this.canRemoveControl(b)){var d=a.nextAll(".cfb-field-control");wp.hooks.doAction("cfb.pre_remove_control",a,b,c),a.remove(),this.updateControls(d,b,c),this.toggleHandles(b),wp.hooks.doAction("cfb.removed_control",a,b,c)}},updateControls:function(c,d,e){if(c=c.not(".cfb-empty-control"),c.length){d=d||c.closest(".cfb-field-wrapper"),e=e||d.closest(".cfb-form-wrapper");var f,g,h,i,j=this.getFormName(e),k=this.getFieldName(d),l=new RegExp("(cfb-field-"+j+"-"+k.replace(/:/g,"(?:-\\d+)?-")+")-(\\d+|x)"),m=new RegExp("(c7_form_builder\\["+j+"\\]\\["+k.replace(/:/g,"\\](?:\\[\\d+\\])?\\[")+"\\])\\[(\\d+|x)\\]");wp.hooks.doAction("cfb.pre_update_controls",c,d,e),c.each(function(){i=b.getFieldControls(d).index(a(this)),a(this).find("label.cfb-field-label").each(function(){h=a(this).attr("for").replace(l,"$1-"+i),a(this).attr("for",h)}),a(this).find("[id]").each(function(){f=a(this).attr("id"),f=f.replace(l,"$1-"+i),a(this).attr("id",f)}),a(this).find("[name]").each(function(){g=a(this).attr("name"),g=g.replace(m,"$1["+i+"]"),a(this).attr("name",g)})}),wp.hooks.doAction("cfb.updated_controls",c,d,e)}},appendHandles:function(b){if(this.isRepeatableField(b)){var c=a(['<div class="cfb-repeatable-handles">','<a href="#" class="cfb-add-control" title="'+this.l18n("add_control_button_text")+'"><span class="cfb-icon cfb-icon-add"></span></a>','<a href="#" class="cfb-remove-control" title="'+this.l18n("remove_control_button_text")+'"><span class="cfb-icon cfb-icon-remove"></span></a>',"</div>"].join("")),d=a('<span class="cfb-sort-handle" title="'+this.l18n("sort_control_button_text")+'"><span class="cfb-icon cfb-icon-sort"></span></span>');wp.hooks.doAction("cfb.pre_append_handles",b),this.getFieldControls(b,!0).prepend(d).append(c),wp.hooks.doAction("cfb.appended_handles",b),this.toggleHandles(b)}},toggleHandles:function(b){var c=this,d=b.find(".cfb-repeatable-handles").filter(function(){return c.getFieldName(b)===c.getFieldName(a(this).closest(".cfb-field-wrapper"))});d.find(".cfb-add-control").toggle(this.canAddControl(b)),d.find(".cfb-remove-control").toggle(this.canRemoveControl(b))}};return a(function(){wp.hooks.doAction("cfb.ready",a("body"))}),wp.hooks.addAction("cfb.ready",function(c){c.find(".cfb-form-wrapper").each(function(){wp.hooks.doAction("cfb.ready_form",a(this)),wp.hooks.doAction("cfb.ready_"+b.getFormType(a(this))+"_form",a(this))})}),wp.hooks.addAction("cfb.ready_form",function(c){c.find(".cfb-field-wrapper").not(".cfb-empty-control .cfb-field-wrapper").each(function(){wp.hooks.doAction("cfb.ready_field",a(this),c),wp.hooks.doAction("cfb.ready_"+b.getFieldType(a(this))+"_field",a(this),c)})}),wp.hooks.addAction("cfb.ready_field",function(c,d){b.getFieldControls(c).each(function(){wp.hooks.doAction("cfb.ready_field_control",a(this),c,d),wp.hooks.doAction("cfb.ready_"+b.getFieldType(c)+"_field_control",a(this),c,d)})}),wp.hooks.addAction("cfb.ready_form",function(c){c.on("click",".cfb-repeatable-handles",function(d){d.preventDefault(),d.stopPropagation();var e=a(d.currentTarget).closest(".cfb-field-wrapper"),f=a(d.currentTarget).parentsUntil(".cfb-field-control-wrapper",".cfb-field-control");f.length||(f=b.getFieldControls(e).last()),a(d.target).closest(".cfb-add-control").length>0?b.addControl(f,e,c):a(d.target).closest(".cfb-remove-control").length>0&&b.removeControl(f,e,c)})}),wp.hooks.addAction("cfb.ready_field",function(a){b.appendHandles(a)}),wp.hooks.addAction("cfb.added_control",function(c,d,e){wp.hooks.doAction("cfb.ready_field_control",c,d,e),wp.hooks.doAction("cfb.ready_"+b.getFieldType(d)+"_field_control",c,d,e),c.find(".cfb-field-wrapper").not(".cfb-empty-control .cfb-field-wrapper").each(function(){wp.hooks.doAction("cfb.ready_field",a(this),e),wp.hooks.doAction("cfb.ready_"+b.getFieldType(a(this))+"_field",a(this),e)})}),wp.hooks.addAction("cfb.ready_form",b.tabs.initialize,10,b.tabs),wp.hooks.addAction("cfb.ready_field",b.sortable.initialize),wp.hooks.addAction("cfb.activated_tab",function(a){a.find(".cfb-submit-field:not([data-tab])").fadeIn()}),wp.hooks.addAction("cfb.sortupdate",function(c,d){var e=a(c.target).find("> .cfb-field-control").not(".cfb-empty-control").index(d.item);e>d.item.data("sortstart-index")?b.updateControls(d.item.prevAll(".cfb-field-control").addBack()):b.updateControls(d.item.nextAll(".cfb-field-control").addBack())}),wp.hooks.addAction("cfb.ready_color_field_control",b.fields.color.initialize),wp.hooks.addAction("cfb.ready_editor_field_control",b.fields.editor.initialize),wp.hooks.addAction("cfb.pre_remove_control",b.fields.editor.destroy),wp.hooks.addAction("cfb.pre_update_controls",b.fields.editor.destroy),wp.hooks.addAction("cfb.updated_controls",function(c){b.getAllFieldControls(c,{type:"editor",includeEmpty:!0}).each(function(){var b=a(this).find(".wp-editor-area").attr("id");a(this).find(".wp-switch-editor[data-wp-editor-id]").attr("data-wp-editor-id",b),a(this).find(".add_media[data-editor]").attr("data-editor",b)}),b.fields.editor.initialize(c)}),wp.hooks.addAction("cfb.sortstart",function(a,c){b.fields.editor.destroy(c.item)}),wp.hooks.addAction("cfb.sortstop",function(a,c){b.fields.editor.initialize(c.item)}),wp.hooks.addAction("cfb.ready",function(c){c.find("#poststuff").on("sortstart",function(c){b.fields.editor.destroy(a(c.target))}).on("sortstop",function(c){b.fields.editor.initialize(a(c.target))})}),b}(jQuery);